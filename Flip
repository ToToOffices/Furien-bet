#include <amxmodx>
#include <fakemeta>
#include <engine>

#define FLIP_COOLDOWN 1.0

new Float:lastFlip[33];

public plugin_init()
{
    register_plugin("Player Flip / Tumble", "1.0", "ChatGPT");

    register_forward(FM_PlayerPreThink, "fw_PlayerPreThink");
}

public fw_PlayerPreThink(id)
{
    if(!is_user_alive(id))
        return FMRES_IGNORED;

    // SHIFT + SPACE
    if( (pev(id, pev_button) & IN_JUMP) && (pev(id, pev_button) & IN_DUCK) )
    {
        new Float:time = get_gametime();
        if(time - lastFlip[id] < FLIP_COOLDOWN)
            return FMRES_IGNORED;

        lastFlip[id] = time;
        DoFlip(id);
    }

    return FMRES_IGNORED;
}

public DoFlip(id)
{
    // Rotire doar model, camera rămâne normală
    static Float:angles[3];
    pev(id, pev_angles, angles);

    // Aplicăm o animație rapidă (360 grade în față)
    set_task(0.01, "FlipStep", id, _, _, "a", 15);

    return 1;
}

public FlipStep(id)
{
    if(!is_user_alive(id))
        return;

    static Float:oldAng[3];
    pev(id, pev_angles, oldAng);

    oldAng[0] += 24.0;   // 24 * 15 ≈ 360° flip în față

    if(oldAng[0] > 360.0)
        oldAng[0] -= 360.0;

    // Setăm doar modelul
    set_pev(id, pev_angles, oldAng);
    set_pev(id, pev_v_angle, {0.0, 0.0, 0.0}); // camera rămâne fixă
}
